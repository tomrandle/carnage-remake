<!DOCTYPE html>
<html>
<head>
    <title>Carnage remake</title>

    <script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.min.js"></script>

    <script src="keyStatus.js"></script>
    <script src="jquery.hotkeys.js"></script>

    <script>

        $(document).ready(function() {


            /* Set up */


            var FPS = 30;
            var g = 9.81;
            var timeInterval = 1 / FPS;

            var canvasWidth = $(window).width();
            var canvasHeight = $(window).height();

            var canvasElement = $("<canvas width='" + canvasWidth + "' height='" + canvasHeight + "'></canvas>");
            var canvas = canvasElement.get(0).getContext("2d");

            canvasElement.appendTo('body');



            /* Each frame */
    
            function update() {
                

                /* Infinite canvas */

                if (player.x > canvasWidth) {
                    player.x = 0;
                }

                if (player.x < 0) {
                    player.x = canvasWidth;
                }


                if (player.y > canvasHeight) {
                    player.y = 0;
                }

                if (player.y < 0) {
                    player.y = canvasHeight;
                }


                /* Crash */ 



                /* Forward motion */


                player.calculatePositions();

                /* Keyboard inputs */


                if (keydown.left) {
                    player.planeDirection -= player.turnSpeed;
                }

                if (keydown.right) {
                    player.planeDirection += player.turnSpeed;

                }


                if (player.planeDirection >= (2 * Math.PI))
                {
                    player.planeDirection = player.planeDirection - (2 * Math.PI);
                }

                else {
                    if (player.planeDirection < 0)
                    {
                        player.planeDirection = player.planeDirection + 2 * Math.PI;
                    }
                }
            }

    
            function draw() {
                canvas.clearRect(0, 0, canvasWidth, canvasHeight);
                player.draw();
            }
            
            
            setInterval(function() {
                update();
                draw();
            }, 1000/FPS);

            var player = {
                color: "#00A",
                x: 220,
                y: 270,
                planeDirection: Math.PI,
                turnSpeed: Math.PI / 180,
                xSpeed:0,
                ySpeed:0,
                width:100,
                height:50,
                mass:10, 
                weight: 100, 
                calculateLift: function() {
                    return (this.weight);
                },
                thrust: 1,
                calculateDrag: function() {
                    return (0.1 * this.thrust);
                },
                calculateXAcceleration: function(){
                    // ((F-D)cosC + L sin C ) / m;
                    var a = ((this.thrust - this.calculateDrag()) * Math.cos(this.planeDirection) - (this.calculateLift() * Math.sin(this.planeDirection))) / this.mass;
                    return(a);
                },

                calculateYAcceleration: function(){
                    // ((F-D)sinC + L cos C - W) / m;
                    var a = ((this.thrust - this.calculateDrag()) * Math.sin(this.planeDirection) + (this.calculateLift() * Math.cos(this.planeDirection)) - this.weight) / this.mass;
                    return(a);
                },


                calculateSpeeds: function () {
                    var aX = this.calculateYAcceleration();
                    var aY = this.calculateXAcceleration();

                    /* v = u + at */

                    this.xSpeed = this.xSpeed + (aX * timeInterval);
                    this.ySpeed = this.ySpeed + (aY * timeInterval);

                },

                calculatePositions: function() {
                        
                    this.calculateSpeeds();
                    /* s = ut + 0.5 at^2*/
                    /*BODGE*/

                    this.x = this.x + (this.xSpeed * timeInterval);
                    this.y = this.y + (this.ySpeed * timeInterval);

                },
                airspeed: function() {
                    this.calculateSpeeds();
                    var v = (Math.sqrt(Math.pow(this.xSpeed,2) + Math.pow(this.ySpeed,2)));
                    return(v);
                },

                updateReadings: function() {
                    $('#bearing-value').html(this.planeDirection);
                    $('#acceleration-x-value').html(this.calculateXAcceleration());
                    $('#acceleration-y-value').html(this.calculateYAcceleration());
                    $('#speed-x-value').html(this.xSpeed);
                    $('#speed-y-value').html(this.ySpeed);
                    $('#airspeed-value').html(this.airspeed());






                },
                draw: function() {

                    this.updateReadings();
                    canvas.save();
                    canvas.translate(this.x, this.y);
                    canvas.translate(this.width, this.height);
                    canvas.rotate(this.planeDirection);
                    canvas.fillStyle = this.color;
                    canvas.fillRect((- this.width / 2), (- this.height / 2), this.width, this.height);
                    canvas.restore();
                },
        


            };

        });


    </script>

    <style type="text/css">
        body {margin: 0;}

        canvas {background: lightblue;}
        table {position: fixed; right:10px; top:10px; width: 100px;}
    </style>

</head>

<body>
    <table id="data">
        <tr>
            <td>Bearing</td><td id="bearing-value"></td>
        </tr>
        <tr>
            <td>aX</td><td id="acceleration-x-value"></td>
        </tr>
        <tr>
            <td>aY</td><td id="acceleration-y-value"></td>

        </tr>
           <tr>
            <td>vX</td><td id="speed-x-value"></td>
        </tr>
        <tr>
            <td>vY</td><td id="speed-y-value"></td>

        </tr>
            <tr>
            <td>vY</td><td id="airspeed-value"></td>

        </tr>

    </table>
</body>

</html>