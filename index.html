<!DOCTYPE html>
<html>
<head>
    <title>Carnage remake</title>

    <script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.min.js"></script>

    <script src="keyStatus.js"></script>
    <script src="jquery.hotkeys.js"></script>

    <script>

        $(document).ready(function() {


            /* Set up */


            var FPS = 30;
            var g = 9.81;
            var timeInterval = 1 / FPS;

            var canvasWidth = $(window).width();
            var canvasHeight = $(window).height();

            var canvasElement = $("<canvas width='" + canvasWidth + "' height='" + canvasHeight + "'></canvas>");
            var canvas = canvasElement.get(0).getContext("2d");

            canvasElement.appendTo('body');



            /* Each frame */
    
            function update() {
                

                /* Infinite canvas */

                if (player.x > canvasWidth) {
                    player.x = 0;
                }

                if (player.x < 0) {
                    player.x = canvasWidth;
                }


                if (player.y > canvasHeight) {
                    player.y = 0;
                }

                if (player.y < 0) {
                    player.y = canvasHeight;
                }


                /* Crash */ 



                /* Forward motion */


                player.calculatePositions();

                /* Keyboard inputs */


                if (keydown.left) {
                    player.angleOfAttack += player.turnSpeed;
                }

                if (keydown.right) {
                    player.angleOfAttack -= player.turnSpeed;

                }


                if (player.angleOfAttack >= (Math.PI))
                {
                    player.angleOfAttack = player.angleOfAttack - (Math.PI * 2);
                }

                else {
                    if (player.angleOfAttack <= - Math.PI)
                    {
                        player.angleOfAttack = player.angleOfAttack + (2 * Math.PI);
                    }
                }
            }

    
            function draw() {
                canvas.clearRect(0, 0, canvasWidth, canvasHeight);
                player.draw();
            }
            
            
            setInterval(function() {
                update();
                draw();
            }, 1000/FPS);

            var player = {
                color: "#00A",
                x: 220,
                y: 270,
                angleOfAttack: 0,
                turnSpeed: Math.PI / 180,
                xSpeed:0,
                ySpeed:0,
                width:50,
                height:25,
                mass:1,
                weight: 10,
                terminalVelocity:50, 
                calculateLift: function() {
                    return (this.weight);
                },
                thrust: 10,
                calculateDrag: function() {
                    var drag =  ((this.airspeed() * this.thrust) / (this.airspeed() + 3));
                    return(drag)
                },
                calculateXAcceleration: function(){
                    // ((F-D)cosC + L sin C ) / m;
                    var angle = this.angleOfAttack;

                    var thrustComponent = this.thrust *  Math.cos(angle);
                    var dragComponent = this.calculateDrag() * Math.cos(angle);
                    var liftComponent = this.calculateLift() * Math.sin(angle);

                    console.log('x thrust, drag, lift', thrustComponent,dragComponent,liftComponent);

                    var a = (thrustComponent - dragComponent + liftComponent) / this.mass;
                    return(a);
                },

                calculateYAcceleration: function(){
                    // ((F-D)sinC + L cos C - W) / m;
                    var angle = this.angleOfAttack;

                    var thrustComponent = this.thrust *  Math.sin(angle);
                    var dragComponent = this.calculateDrag() * Math.sin(angle);
                    var liftComponent = this.calculateLift() * Math.cos(angle);

                    console.log('y thrust, drag, lift',thrustComponent,dragComponent,liftComponent);



                    var a = (thrustComponent - dragComponent + liftComponent - this.weight) /this.mass;
                    return(a);

                    // var a = ((this.thrust - this.calculateDrag()) * Math.sin(angle) + (this.calculateLift() * Math.cos(angle)) - this.weight) / this.mass;
                    // return(a);
                },


                calculateSpeeds: function () {
                    var aX = this.calculateXAcceleration();
                    var aY = this.calculateYAcceleration();

                    /* v = u + at */

                    this.xSpeed = this.xSpeed + (aX * timeInterval);
                    this.ySpeed = this.ySpeed + (aY * timeInterval);

                },

                calculatePositions: function() {
                        
                    this.calculateSpeeds();
                    /* s = ut + 0.5 at^2*/
                    /*BODGE*/

                    this.x = this.x + (this.xSpeed * timeInterval);
                    this.y = this.y + (this.ySpeed * timeInterval);

                },
                airspeed: function() {
                    var v = (Math.sqrt(Math.pow(this.xSpeed,2) + Math.pow(this.ySpeed,2)));
                    return(v);
                },

                updateReadings: function() {
                    $('#bearing-value').html(this.angleOfAttack * 180 / Math.PI);
                    $('#acceleration-x-value').html(this.calculateXAcceleration());
                    $('#acceleration-y-value').html(this.calculateYAcceleration());
                    $('#speed-x-value').html(this.xSpeed);
                    $('#speed-y-value').html(this.ySpeed);
                    $('#x-value').html(this.x);
                    $('#y-value').html(this.y);
                    $('#airspeed-value').html(this.airspeed());
                    $('#drag-value').html(this.calculateDrag());

                },
                draw: function() {
                    this.updateReadings();
                    canvas.save();
                    canvas.translate(this.x, (canvasHeight - this.y));
                    canvas.translate(this.width, this.height);
                    canvas.rotate(-this.angleOfAttack);
                    canvas.fillStyle = this.color;
                    canvas.fillRect((- this.width / 2), (- this.height / 2), this.width, this.height);
                    canvas.restore();
                },
            };
        });

    </script>

    <style type="text/css">
        body {margin: 0;}
        canvas {background: lightblue;}
        table {position: fixed; right:10px; top:10px; width: 100px;}
    </style>

</head>

<body>
    <table id="data">
        <tr>
            <td>Bearing</td><td id="bearing-value"></td>
        </tr>
        <tr>
            <td>X</td><td id="x-value"></td>
        </tr>
        <tr>
            <td>Y</td><td id="y-value"></td>

        </tr>
        <tr>
            <td>aX</td><td id="acceleration-x-value"></td>
        </tr>
        <tr>
            <td>aY</td><td id="acceleration-y-value"></td>

        </tr>
           <tr>
            <td>vX</td><td id="speed-x-value"></td>
        </tr>
        <tr>
            <td>vY</td><td id="speed-y-value"></td>

        </tr>
            <tr>
            <td>Speed</td><td id="airspeed-value"></td>

        </tr>
                 <tr>
            <td>Drag</td><td id="drag-value"></td>

        </tr>

    </table>
</body>

</html>